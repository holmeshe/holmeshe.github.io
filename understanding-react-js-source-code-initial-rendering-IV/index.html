<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Holmes He</title>

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="JavaScriptreactreact.jsprogrammingcode">
  
  
  
  
  <meta name="description" content="We have completed the rendering process of a simple component. This time we are going to explore more ramifications of this process by discussing how a class component (a typical one we might use in e">
<meta name="keywords" content="JavaScript,react,react.js,programming,code">
<meta property="og:type" content="article">
<meta property="og:title" content="Understanding The React Source Code - Initial Rendering (Class Component) IV">
<meta property="og:url" content="https://holmeshe.me/understanding-react-js-source-code-initial-rendering-IV/index.html">
<meta property="og:site_name" content="Holmes He">
<meta property="og:description" content="We have completed the rendering process of a simple component. This time we are going to explore more ramifications of this process by discussing how a class component (a typical one we might use in e">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*qfcdcoJxQi-tAT_is56jIg.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*deVmwq0d4e43Ilb0HeXfeg.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*i1AjjHhNllLAKdISLgLwsg.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*hySbQvGxSEY_Y66hbwQHnw.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*weoV4muXhIP4kLwGtC99Pw.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*tC53yQsdIgjMhPYp67AirA.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*Zep4SB3SXHmHCsxrQt8tzA.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*5Eui2ntr6WyGjFLg5i1pNw.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*F1FCaO0teKiN_eZ88C7ebQ.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*MeC88ScD8YduwPzbYjTpZg.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*-maFq-019TbfEb6hrE9uyQ.png">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*IFbUo5kw4aUZlapVE73POQ.png">
<meta property="og:updated_time" content="2020-12-22T10:48:38.121Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Understanding The React Source Code - Initial Rendering (Class Component) IV">
<meta name="twitter:description" content="We have completed the rendering process of a simple component. This time we are going to explore more ramifications of this process by discussing how a class component (a typical one we might use in e">
<meta name="twitter:image" content="https://cdn-images-1.medium.com/max/800/1*qfcdcoJxQi-tAT_is56jIg.png">
  
  <link rel="icon" href="/gallery/air-balloon.svg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">
  <link rel="stylesheet" href="/css/fashion.css">
  <link rel="stylesheet" href="/css/glyphs.css">

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  


<header id="allheader" class="site-header" role="banner" 
   
>
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" rel="home" >
                <img style="margin-bottom: 10px;"  width="124px" height="124px" alt="Code Talks" src=" /gallery/air-balloon.svg">
              </a>
            
          </h1>
          
          <div class="site-description">
            \{C}0de<t>a1k(s) =>
            <text id="message">
              
            </text>
            ( ͡° ͜ʖ ͡°)
            <a class='ext-link' href="/atom.xml">
              <i class="fas fa-rss fa-lg"></i>
            </a>
          </div>
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">Series</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-understanding-react-js-source-code-initial-rendering-IV" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Understanding The React Source Code - Initial Rendering (Class Component) IV
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/understanding-react-js-source-code-initial-rendering-IV/" class="article-date">
	  <time datetime="2018-01-06T11:00:00.000Z" itemprop="datePublished">January 7, 2018</time>
	</a>

      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/Understanding-The-React-Source-Code/">Understanding The React Source Code</a>
 
      
    </div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We have completed the rendering process of a simple component. This time we are going to explore more ramifications of this process by discussing how a class component (a typical one we might use in everyday development) is rendered.</p>
<a id="more"></a>
<p><strong><em>Files used in this article</em></strong>: the same as <a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-I/">post one</a> and <a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-II/">two</a></p>
<blockquote>
<p>I use {} to reference the previous post that is relevant to the methods (or logic process) being discussed.</p>
</blockquote>
<p>The component named <code>App</code> is similar to what I gave in the beginning of <a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-I/">post one</a>, in which we considered it too complex for beginners. But since we have leveled-up a bit, it does not look that daunting anymore.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> ‘react’;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> ‘./logo.svg’;</span><br><span class="line"><span class="keyword">import</span> ‘./App.css’;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      desc: <span class="string">'start'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">"App-header"</span>&gt;</span><br><span class="line">          &lt;img src=<span class="string">"main.jpg"</span> className=<span class="string">"App-logo"</span> alt=<span class="string">"logo"</span> /&gt;</span><br><span class="line">          &lt;h1&gt; <span class="string">"Welcom to React"</span> &lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &lt;p className=<span class="string">"App-intro"</span>&gt;</span><br><span class="line">          &#123; <span class="keyword">this</span>.state.desc &#125;</span><br><span class="line">        &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br><span class="line">App@App.js</span><br></pre></td></tr></table></figure>
<p>As mentioned, the component above is rendered using:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;App /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(‘root’)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Now the babeled code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      desc: <span class="string">'start'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(</span><br><span class="line">      <span class="string">'div'</span>,</span><br><span class="line">      &#123; <span class="attr">className</span>: <span class="string">'App'</span> &#125;,</span><br><span class="line">      React.createElement(</span><br><span class="line">        <span class="string">'div'</span>,</span><br><span class="line">        &#123; <span class="attr">className</span>: <span class="string">'App-header'</span> &#125;,</span><br><span class="line">        React.createElement(</span><br><span class="line">          <span class="string">'img'</span>,</span><br><span class="line">          &#123; <span class="attr">src</span>: <span class="string">"main.jpg"</span>, <span class="attr">className</span>: <span class="string">'App-logo'</span>, <span class="attr">alt</span>: <span class="string">'logo'</span> &#125;</span><br><span class="line">        ),</span><br><span class="line">        React.createElement(</span><br><span class="line">          <span class="string">'h1'</span>,</span><br><span class="line">          <span class="literal">null</span>,</span><br><span class="line">          <span class="string">' "Welcom to React" '</span></span><br><span class="line">        )</span><br><span class="line">      ),</span><br><span class="line">      React.createElement(</span><br><span class="line">        <span class="string">'p'</span>,</span><br><span class="line">        &#123; <span class="attr">className</span>: <span class="string">'App-intro'</span> &#125;,</span><br><span class="line">        <span class="keyword">this</span>.state.desc</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ReactDOM.render(React.createElement(App, <span class="literal">null</span>), <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure>
<p>Here we consider <code>Component</code> a common base class, as other methods will not be used in this post.</p>
<p>This time we can fast forward the logic that is shared with simple component.</p>
<h1 id="Construct-the-top-level-wrapper-ReactCompositeComponent-T"><a href="#Construct-the-top-level-wrapper-ReactCompositeComponent-T" class="headerlink" title="Construct the top level wrapper ReactCompositeComponent[T]"></a>Construct the top level wrapper <code>ReactCompositeComponent[T]</code></h1><p>The designated data structure:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*qfcdcoJxQi-tAT_is56jIg.png" alt></p>
<p>This step is almost the same as that in simple component rendering, so I will give a brief description only, it</p>
<p>1) creates <code>ReactElement[1]</code> using <code>ReactElement.createElement(type, config, children)</code> (This time <code>App</code> is passed to <code>type</code>, and <code>config</code>, <code>children</code> are <code>null</code>);</p>
<ol start="2">
<li><p>creates <code>ReactElement[2]</code> in <code>_renderSubtreeIntoContainer()</code>;</p>
</li>
<li><p>creates the designated wrapper with <code>instantiateReactComponent()</code>.</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReactElement.createElement(type,    <span class="comment">// scr: -------------&gt; App</span></span><br><span class="line">                           config,  <span class="comment">// scr: -------------&gt; null</span></span><br><span class="line">                           children <span class="comment">// scr: -------------&gt; null</span></span><br><span class="line">) <span class="comment">// scr: ------------------------------------------------------&gt; 1)</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn-images-1.medium.com/max/800/1*deVmwq0d4e43Ilb0HeXfeg.png" alt></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render</span><br><span class="line">|=ReactMount.render(nextElement, container, callback)</span><br><span class="line">|=ReactMount._renderSubtreeIntoContainer(</span><br><span class="line">   parentComponent, <span class="comment">// scr: ----&gt; null</span></span><br><span class="line">   nextElement,     <span class="comment">// scr: ----&gt; ReactElement[1]</span></span><br><span class="line">   container,       <span class="comment">// scr: ----&gt; document.getElementById(‘root’)</span></span><br><span class="line">   callback’        <span class="comment">// scr: ----&gt; undefined</span></span><br><span class="line">) <span class="comment">// scr: ------------------------------------------------------&gt; 2)</span></span><br><span class="line">  |-instantiateReactComponent( <span class="comment">// scr: -------------------------&gt; 3)</span></span><br><span class="line">      node, <span class="comment">// scr: ------&gt; ReactElement[2]</span></span><br><span class="line">      shouldHaveDebugID <span class="comment">/* false */</span></span><br><span class="line">    )</span><br><span class="line">    |-ReactCompositeComponentWrapper(</span><br><span class="line">        element <span class="comment">// scr: ------&gt; ReactElement[2]</span></span><br><span class="line">      );</span><br><span class="line">    |=ReactCompositeComponent.construct(element <span class="comment">/* same */</span>)</span><br></pre></td></tr></table></figure>
<p>This is what we covered in {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-I/">post one</a>}.</p>
<h1 id="Initialize-ReactCompositeComponent-T"><a href="#Initialize-ReactCompositeComponent-T" class="headerlink" title="Initialize ReactCompositeComponent[T]"></a>Initialize <code>ReactCompositeComponent[T]</code></h1><p>The designated data structure:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*i1AjjHhNllLAKdISLgLwsg.png" alt></p>
<p>The step is the same as well:</p>
<p>1) <code>ReactDOMContainerInfo[ins]</code> represents the container DOM element, <code>document.getElementById(‘root’)</code>;</p>
<p>2) <code>TopLevelWrapper</code> is instantiated (<code>TopLevelWrapper[ins]</code>) and is set to <code>ReactCompositeComponent[T]._instance</code> alongside the initialization of other properties;</p>
<p>3) Again, <code>mountComponentIntoNode</code> is the cross point of upper and lower half, within which <code>ReactCompositeComponent[T].mountComponent</code> returns a complete <code>DOMLazyTree</code> that can be used by <code>ReactMount._mountImageIntoNode</code>, a method from lower half.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render                                           ___</span><br><span class="line">|=ReactMount.render(nextElement, container, callback)      |</span><br><span class="line">|=ReactMount._renderSubtreeIntoContainer()                 |</span><br><span class="line">  |-ReactMount._renderNewRootComponent()                   |</span><br><span class="line">  |-instantiateReactComponent()                            |</span><br><span class="line">    |~batchedMountComponentIntoNode()                 upper half</span><br><span class="line">      |~mountComponentIntoNode()                (platform agnostic)</span><br><span class="line">        |-ReactReconciler.mountComponent() <span class="comment">// scr-----&gt; 1) |</span></span><br><span class="line">          |-ReactCompositeComponent[T].mountComponent() scr:&gt; <span class="number">2</span>)<span class="number">3</span>)                    </span><br><span class="line">            ...                                           _|_</span><br><span class="line">               ...                                    lower half</span><br><span class="line">        |-_mountImageIntoNode()                 (HTML DOM specific)</span><br></pre></td></tr></table></figure>
<p>This is what we covered in the first part of {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-II/">post two</a>}.</p>
<p>Except for some small differences in regard to argument values, the the top level wrapper related operations are exactly the same as what we discussed in previous posts. After those operations complete, the logic processes to the first ramification that is specific to class component.</p>
<h1 id="ReactCompositeComponent-T-performInitialMount-—-create-a-ReactCompositeComponent-from-ReactElement-1"><a href="#ReactCompositeComponent-T-performInitialMount-—-create-a-ReactCompositeComponent-from-ReactElement-1" class="headerlink" title="ReactCompositeComponent[T].performInitialMount() — create a ReactCompositeComponent from ReactElement[1]"></a><code>ReactCompositeComponent[T].performInitialMount()</code> — create a <code>ReactCompositeComponent</code> from <code>ReactElement[1]</code></h1><p>This step strips the wrapper and creates another <code>ReactCompositeComponent</code> instance to reflect <code>App</code> component.</p>
<p>The designated data structure:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*hySbQvGxSEY_Y66hbwQHnw.png" alt></p>
<p>The call stack in action:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">|~mountComponentIntoNode()                                    |</span><br><span class="line">  |-ReactReconciler.mountComponent()                          |</span><br><span class="line">    |-ReactCompositeComponent[T].mountComponent()             |</span><br><span class="line">      <span class="comment">/* we are here */</span>                                       |</span><br><span class="line">      |-ReactCompositeComponent[T].performInitialMount(       |</span><br><span class="line">          renderedElement,   <span class="comment">// scr: -------&gt; undefined       |</span></span><br><span class="line">          hostParent,        <span class="comment">// scr: -------&gt; null        upper half</span></span><br><span class="line">          hostContainerInfo, <span class="comment">// scr: -------&gt;                 | ReactDOMContainerInfo[ins]                                    |</span></span><br><span class="line">          transaction,       <span class="comment">// scr: -------&gt; not of interest |</span></span><br><span class="line">          context,           <span class="comment">// scr: -------&gt; not of interest |</span></span><br><span class="line">        )                                                     |</span><br></pre></td></tr></table></figure>
<p>The process is very similar to the <code>performInitialMount()</code> in {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-II/">post two</a>}. The only difference here is that based on <code>ReactElement[1].type</code>, <code>_instantiateReactComponent</code> creates a <code>ReactCompositeComponent</code> for the class component (<code>App</code>) instead of a <code>ReactDOMComponent</code>. To put it briefly:</p>
<p>1) it calls <code>_renderValidatedComponent()</code> which in turn calls <code>TopLevelWrapper.render()</code> to extract <code>ReactElement[1]</code>; 2) it instantiates a <code>ReactCompositeComponent</code> with <code>_instantiateReactComponent</code> (we name the object <code>ReactCompositeComponent[ins]</code>); and 3) it calls <code>ReactCompositeComponent[ins].mountComponent</code> (recursively) through <code>ReactReconciler</code>, and moves on to the next step.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">performInitialMount: <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  renderedElement,</span></span></span><br><span class="line"><span class="function"><span class="params">  hostParent,</span></span></span><br><span class="line"><span class="function"><span class="params">  hostContainerInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">  transaction,</span></span></span><br><span class="line"><span class="function"><span class="params">  context</span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> inst = <span class="keyword">this</span>._instance;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (inst.componentWillMount) &#123;</span><br><span class="line">... <span class="comment">// scr: we did not define componentWillMount() in App</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If not a stateless component, we now render</span></span><br><span class="line">  <span class="keyword">if</span> (renderedElement === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    renderedElement = <span class="keyword">this</span>._renderValidatedComponent(); <span class="comment">// scr: &gt; 1)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> nodeType = ReactNodeTypes.getType(renderedElement); <span class="comment">// scr: -&gt; the type is ReactNodeTypes.Composite this time</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>._renderedNodeType = nodeType;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> child = <span class="keyword">this</span>._instantiateReactComponent(renderedElement, nodeType !== ReactNodeTypes.EMPTY <span class="comment">/* shouldHaveDebugID */</span></span><br><span class="line">  );      <span class="comment">// scr: ----------------------------------------------&gt; 2)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>._renderedComponent = child;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> markup = ReactReconciler.mountComponent(child, transaction, hostParent, hostContainerInfo, <span class="keyword">this</span>._processChildContext(context), debugID); <span class="comment">// scr: ----------------------------------------------&gt; 3)</span></span><br><span class="line"></span><br><span class="line">...<span class="comment">// scr: DEV code</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> markup;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">ReactCompositeComponent@renderers/shared/stack/reconciler/ReactCompositeComponent.js</span><br></pre></td></tr></table></figure>
<h1 id="ReactCompositeComponent-ins-mountComponent-—-initialize-ReactCompositeComponent-ins"><a href="#ReactCompositeComponent-ins-mountComponent-—-initialize-ReactCompositeComponent-ins" class="headerlink" title="ReactCompositeComponent[ins].mountComponent() — initialize ReactCompositeComponent[ins]"></a><code>ReactCompositeComponent[ins].mountComponent()</code> — initialize <code>ReactCompositeComponent[ins]</code></h1><p>The designated data structure:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*weoV4muXhIP4kLwGtC99Pw.png" alt></p>
<p>The call stack in action:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">|~mountComponentIntoNode()                                    |</span><br><span class="line">  |-ReactReconciler.mountComponent()                          |</span><br><span class="line">    |-ReactCompositeComponent[T].mountComponent()             |</span><br><span class="line">      |-ReactCompositeComponent[T].performInitialMount()  upper half</span><br><span class="line">        |-ReactReconciler.mountComponent()                    |</span><br><span class="line">          <span class="comment">/* we are here */</span>                                   |</span><br><span class="line">          |-ReactCompositeComponent[ins].mountComponent(same)   |</span><br></pre></td></tr></table></figure>
<p>Same as in <code>ReactCompositeComponent[T].mountComponent()</code> {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-II/">post two</a>}, the most important task of this step is to instantiate <code>App</code> with <code>ReactCompositeComponent[ins]._currentElement</code> (<code>ReactElement[1]</code>).</p>
<p>The line in the method that does the job is:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">var</span> inst = <span class="keyword">this</span>._constructComponent(</span><br><span class="line">    doConstruct,</span><br><span class="line">    publicProps,</span><br><span class="line">    publicContext,</span><br><span class="line">    updateQueue,</span><br><span class="line">  );</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ReactCompositeComponent@renderers/shared/stack/reconciler/ReactCompositeComponent.js</span><br></pre></td></tr></table></figure>
<p>in which the constructor of <code>App</code> gets called.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      desc: <span class="string">'start'</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// copied from the beginning of this text</span></span><br></pre></td></tr></table></figure>
<p>Then (we name it) <code>App[ins]</code> is set to <code>ReactCompositeComponent[ins]._instance</code> and a back-link is also created through <code>ReactInstanceMap</code>.</p>
<blockquote>
<p>This is the custom component App instance which responds to your <code>this.setState(…)</code>.</p>
</blockquote>
<p>Other operations includes: 1) <code>App[ins].props</code> reference <code>ReactElement[1].props</code>; and 2) <code>ReactCompositeComponent[ins]._mountOrder</code> is set to <code>2</code> due to the <code>++</code> operating on the global variable <code>nextMountID</code>.</p>
<p>It is important to note that <code>App[ins].render()</code> is another <code>App</code> method we define in the beginning. Unlike <code>TopLevelWrapper[ins].render()</code> that returns a concrete <code>ReactElement</code> instance, <code>App[ins].render()</code> relies on <code>React.createElement()</code> at the time when it is invoked. We are going to visit this method soon.</p>
<p>Since this step is very similar to that initializes the <code>ReactCompositeComponent[T]</code> {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-II/">post two</a>}, we do not further examine the workhorse method (i.e., <code>mountComponent()</code>).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">mountComponent: <span class="function"><span class="keyword">function</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  transaction,</span></span></span><br><span class="line"><span class="function"><span class="params">  hostParent,</span></span></span><br><span class="line"><span class="function"><span class="params">  hostContainerInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">  context,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">//</span> scr: this ------&gt; ReactCompositeComponent[T]</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">...</span><br><span class="line">  <span class="keyword">this</span>._mountOrder = nextMountID++; <span class="comment">// scr: --------------------&gt; 2)</span></span><br><span class="line">...</span><br><span class="line">  <span class="keyword">var</span> publicProps = <span class="keyword">this</span>._currentElement.props; <span class="comment">// scr: -----------&gt; &#123; child: ReactElement[1] &#125;</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// scr: -------------------------------------------------&gt; critical)</span></span><br><span class="line">  <span class="keyword">var</span> inst = <span class="keyword">this</span>._constructComponent(</span><br><span class="line">    doConstruct,</span><br><span class="line">    publicProps,</span><br><span class="line">    publicContext,</span><br><span class="line">    updateQueue,</span><br><span class="line">  ); <span class="comment">// scr: ----------&gt; call TopLevelWrapper’s constructor</span></span><br><span class="line">  <span class="keyword">var</span> renderedElement;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// These should be set up in the constructor, but as a convenience   </span></span><br><span class="line"><span class="comment">// for simpler class abstractions, we set them up after the fact.</span></span><br><span class="line"><span class="comment">// scr: --------------------------------------------------------&gt; 1)</span></span><br><span class="line">  inst.props = publicProps; <span class="comment">// scr: ----&gt; &#123; child: ReactElement[1] &#125;</span></span><br><span class="line">…</span><br><span class="line">  <span class="comment">// scr: -----------------------------------------------&gt; critical)</span></span><br><span class="line">  <span class="keyword">this</span>._instance = inst; <span class="comment">// scr: ---------------------------------&gt; link the ReactCompositeComponent[T] to the TopLevelWrapper instance</span></span><br><span class="line"><span class="comment">// Store a reference from the instance back to the internal representation</span></span><br><span class="line">  ReactInstanceMap.set(inst, <span class="keyword">this</span>); <span class="comment">// scr: ----------------------&gt; link the TopLevelWrapper instance back to ReactCompositeComponent[T]</span></span><br><span class="line">…</span><br><span class="line">  <span class="keyword">var</span> markup;</span><br><span class="line">  <span class="keyword">if</span> (inst.unstable_handleError) &#123; <span class="comment">// scr: -----------------------&gt; false, TopLevelWrapper.prototype.unstable_handleError is not defined</span></span><br><span class="line">…</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// scr: -------------------------------------------------&gt; next)</span></span><br><span class="line">    markup = <span class="keyword">this</span>.performInitialMount( <span class="comment">// scr: a initial at the end?</span></span><br><span class="line">      renderedElement,</span><br><span class="line">      hostParent,</span><br><span class="line">      hostContainerInfo,</span><br><span class="line">      transaction,</span><br><span class="line">      context,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">…</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> markup;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactCompositeComponent@renderers/shared/stack/reconciler/ReactCompositeComponent.js</span><br></pre></td></tr></table></figure>
<h1 id="ReactCompositeComponent-ins-performInitialMount-—-create-a-ReactDOMComponent"><a href="#ReactCompositeComponent-ins-performInitialMount-—-create-a-ReactDOMComponent" class="headerlink" title="ReactCompositeComponent[ins].performInitialMount() — create a ReactDOMComponent"></a><code>ReactCompositeComponent[ins].performInitialMount()</code> — create a <code>ReactDOMComponent</code></h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">|~mountComponentIntoNode()                                    |</span><br><span class="line">  |-ReactReconciler.mountComponent()                          |</span><br><span class="line">    |-ReactCompositeComponent[T].mountComponent()             |</span><br><span class="line">      |-ReactCompositeComponent[T].performInitialMount()  upper half</span><br><span class="line">        |-ReactReconciler.mountComponent()                    |</span><br><span class="line">          <span class="comment">/* we are here */</span>                                   |</span><br><span class="line">          |-ReactCompositeComponent[ins].mountComponent()       |</span><br><span class="line">            |-<span class="keyword">this</span>.performInitialMount()                      |</span><br><span class="line">              |-<span class="keyword">this</span>._renderValidatedComponent()              |</span><br><span class="line">              |-instantiateReactComponent()                  _|_ </span><br><span class="line">              |-ReactDOMComponent[<span class="number">6</span>].mountComponent()     lower half</span><br></pre></td></tr></table></figure>
<p>We are here again:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">performInitialMount: <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  renderedElement,</span></span></span><br><span class="line"><span class="function"><span class="params">  hostParent,</span></span></span><br><span class="line"><span class="function"><span class="params">  hostContainerInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">  transaction,</span></span></span><br><span class="line"><span class="function"><span class="params">  context</span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> inst = <span class="keyword">this</span>._instance;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (inst.componentWillMount) &#123;</span><br><span class="line">... <span class="comment">// scr: we did not define componentWillMount() in App</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// If not a stateless component, we now render</span></span><br><span class="line">  <span class="keyword">if</span> (renderedElement === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    renderedElement = <span class="keyword">this</span>._renderValidatedComponent(); <span class="comment">// scr: &gt; 1)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> nodeType = ReactNodeTypes.getType(renderedElement); <span class="comment">// scr: -&gt; the type is ReactNodeTypes.Host this time</span></span><br><span class="line">  <span class="keyword">this</span>._renderedNodeType = nodeType;</span><br><span class="line">  <span class="keyword">var</span> child = <span class="keyword">this</span>._instantiateReactComponent(renderedElement, nodeType !== ReactNodeTypes.EMPTY <span class="comment">/* shouldHaveDebugID */</span></span><br><span class="line">  );      <span class="comment">// scr: ----------------------------------------------&gt; 2)</span></span><br><span class="line">  <span class="keyword">this</span>._renderedComponent = child;</span><br><span class="line">  <span class="keyword">var</span> markup = ReactReconciler.mountComponent(child, transaction, hostParent, hostContainerInfo, <span class="keyword">this</span>._processChildContext(context), debugID); <span class="comment">// scr: ----------------------------------------------&gt; 3)</span></span><br><span class="line">...<span class="comment">// scr: DEV code</span></span><br><span class="line">  <span class="keyword">return</span> markup;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">ReactCompositeComponent@renderers/shared/stack/reconciler/ReactCompositeComponent.js</span><br></pre></td></tr></table></figure>
<p>Before the a <code>ReactDOMComponent</code> (we know that this is the class that handle DOM operations) can be created, the <code>ReactElements</code> defined within <code>App[ins]</code> needs to be extracted. To do so, <code>App[ins].render()</code> is called by the following line (in <code>_renderValidatedComponent()</code>) {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-II/">post two</a>}</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">renderedElement = <span class="keyword">this</span>._renderValidatedComponent();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Then <code>App[ins].render()</code> triggers</p>
<h2 id="The-cascading-calls-of-React-createElement"><a href="#The-cascading-calls-of-React-createElement" class="headerlink" title="The cascading calls of React.createElement()"></a>The cascading calls of <code>React.createElement()</code></h2><p>To understand how the <code>ReactElement</code> tree is established, let’s first revisit the <code>App.render()</code> implementation:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> React.createElement(           <span class="comment">// scr: -----------&gt; 5)</span></span><br><span class="line">      <span class="string">'div'</span>,</span><br><span class="line">      &#123; <span class="attr">className</span>: <span class="string">'App'</span> &#125;,</span><br><span class="line">      React.createElement(                <span class="comment">// scr: -----------&gt; 3)</span></span><br><span class="line">        <span class="string">'div'</span>,</span><br><span class="line">        &#123; <span class="attr">className</span>: <span class="string">'App-header'</span> &#125;,</span><br><span class="line">        React.createElement(              <span class="comment">// scr: -----------&gt; 1)</span></span><br><span class="line">          <span class="string">'img'</span>,</span><br><span class="line">          &#123; <span class="attr">src</span>: <span class="string">"main.jpg"</span>, <span class="attr">className</span>: <span class="string">'App-logo'</span>, <span class="attr">alt</span>: <span class="string">'logo'</span> &#125;</span><br><span class="line">        ),</span><br><span class="line">        React.createElement(              <span class="comment">// scr: -----------&gt; 2)</span></span><br><span class="line">          <span class="string">'h1'</span>,</span><br><span class="line">          <span class="literal">null</span>,</span><br><span class="line">          <span class="string">' "Welcom to React" '</span></span><br><span class="line">        )</span><br><span class="line">      ),</span><br><span class="line">      React.createElement(                <span class="comment">// scr: -----------&gt; 4)</span></span><br><span class="line">        <span class="string">'p'</span>,</span><br><span class="line">        &#123; <span class="attr">className</span>: <span class="string">'App-intro'</span> &#125;,</span><br><span class="line">        <span class="keyword">this</span>.state.desc</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// copied from the beginning of this text</span></span><br></pre></td></tr></table></figure>
<p>In this code snippet I also give the call order of <code>createElement()</code>s which follows a very simple principle: arguments should be resolved (with <code>createElement()</code>) from left to right before a function (of <code>createElement()</code>) gets called.</p>
<p>Then we can examine the creation of each <code>ReactElement</code> {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-I/">post one</a>}.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">React.createElement( <span class="comment">// scr: --------------------------------&gt; 1)</span></span><br><span class="line">  ‘img’,</span><br><span class="line">  &#123; <span class="attr">src</span>: <span class="string">"main.jpg"</span>, <span class="attr">className</span>: ‘App-logo’, <span class="attr">alt</span>: ‘logo’ &#125;</span><br><span class="line">),</span><br></pre></td></tr></table></figure>
<p>creates <code>ReactElement[2]</code>:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*tC53yQsdIgjMhPYp67AirA.png" alt></p>
<p>; and</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">React.createElement( <span class="comment">// scr: --------------------------------&gt; 2)</span></span><br><span class="line">  ‘h1’,</span><br><span class="line">  <span class="literal">null</span>,</span><br><span class="line">  ‘Welcome to React’</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>creates <code>ReactElement[3]</code>:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*Zep4SB3SXHmHCsxrQt8tzA.png" alt></p>
<p>(Now the two arguments for 3) are resolved.)</p>
<p>; and</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(                <span class="comment">// scr: -----------&gt; 3)</span></span><br><span class="line">  <span class="string">'div'</span>,</span><br><span class="line">  ReactElement[<span class="number">2</span>],</span><br><span class="line">  ReactElement[<span class="number">3</span>]</span><br><span class="line">),</span><br></pre></td></tr></table></figure>
<p>creates <code>ReactElement[4]</code>:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*5Eui2ntr6WyGjFLg5i1pNw.png" alt></p>
<p>; and</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(                <span class="comment">// scr: -----------&gt; 4)</span></span><br><span class="line">  <span class="string">'p'</span>,</span><br><span class="line">  &#123; <span class="attr">className</span>: <span class="string">'App-intro'</span> &#125;,</span><br><span class="line">  <span class="keyword">this</span>.state.desc</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>creates <code>ReactElement[5]</code>:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*F1FCaO0teKiN_eZ88C7ebQ.png" alt></p>
<p>(Now the arguments for 5) are resolved.)</p>
<p>; and</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> React.createElement(           <span class="comment">// scr: -----------&gt; 5)</span></span><br><span class="line">  <span class="string">'div'</span>,</span><br><span class="line">  &#123; <span class="attr">className</span>: <span class="string">'App'</span> &#125;,</span><br><span class="line">  ReactElement[<span class="number">4</span>],</span><br><span class="line">  ReactElement[<span class="number">5</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>creates <code>ReactElement[6]</code>:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*MeC88ScD8YduwPzbYjTpZg.png" alt></p>
<p>Combined together we got the element tree referenced by <code>renderedElement</code>:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*-maFq-019TbfEb6hrE9uyQ.png" alt></p>
<h2 id="ReactCompositeComponent-ins-instantiateReactComponent-—-Create-ReactDOMComponent-6"><a href="#ReactCompositeComponent-ins-instantiateReactComponent-—-Create-ReactDOMComponent-6" class="headerlink" title="ReactCompositeComponent[ins]._instantiateReactComponent() — Create ReactDOMComponent[6]"></a><code>ReactCompositeComponent[ins]._instantiateReactComponent()</code> — Create <code>ReactDOMComponent[6]</code></h2><p>The designated data structure:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*IFbUo5kw4aUZlapVE73POQ.png" alt></p>
<p>The element tree created in the last step is used to create the <code>ReactDOMComponent[6]</code> by the following line (within <code>_instantiateReactComponent()</code>) {<a href="http://holmeshe.me/understanding-react-js-source-code-initial-rendering-II/">post two</a>}</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> child = <span class="keyword">this</span>._instantiateReactComponent(</span><br><span class="line">  renderedElement,</span><br><span class="line">  nodeType !== ReactNodeTypes.EMPTY <span class="comment">/* shouldHaveDebugID */</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Now <code>ReactReconciler.mountComponent()</code> calls the <code>mountComponent()</code> of the <code>ReactDOMComponent[6]</code> and the logic processes to the lower half.</p>
<p>to be continued…</p>

      
    </div>
    
    <p>
    <div>
        
          That's it. Did I make a serious mistake? or miss out on anything important? Or you simply like the read. Link me on <a class="ext-link" href='https://hackernoon.com/understanding-the-react-source-code-iv-e3c4b66da12c'>
            <i class="fa fa-medium" aria-hidden="true"></i>
          </a>  -- I'd be chuffed to hear your feedback.
        
    </div>
    
    <p>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/Understanding-The-React-Source-Code/">Understanding The React Source Code</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/code/">code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming/">programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-js/">react.js</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
    
<nav id="article-nav">
  
    <a href="/understanding-react-js-source-code-initial-rendering-V/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Understanding The React Source Code - Initial Rendering (Class Component) V
        
      </div>
    </a>
  
  
    <a href="/understanding-react-js-source-code-initial-rendering-III/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Understanding The React Source Code - Initial Rendering (Simple Component) III</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Construct-the-top-level-wrapper-ReactCompositeComponent-T"><span class="nav-number">1.</span> <span class="nav-text">Construct the top level wrapper ReactCompositeComponent[T]</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Initialize-ReactCompositeComponent-T"><span class="nav-number">2.</span> <span class="nav-text">Initialize ReactCompositeComponent[T]</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ReactCompositeComponent-T-performInitialMount-—-create-a-ReactCompositeComponent-from-ReactElement-1"><span class="nav-number">3.</span> <span class="nav-text">ReactCompositeComponent[T].performInitialMount() — create a ReactCompositeComponent from ReactElement[1]</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ReactCompositeComponent-ins-mountComponent-—-initialize-ReactCompositeComponent-ins"><span class="nav-number">4.</span> <span class="nav-text">ReactCompositeComponent[ins].mountComponent() — initialize ReactCompositeComponent[ins]</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ReactCompositeComponent-ins-performInitialMount-—-create-a-ReactDOMComponent"><span class="nav-number">5.</span> <span class="nav-text">ReactCompositeComponent[ins].performInitialMount() — create a ReactDOMComponent</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-cascading-calls-of-React-createElement"><span class="nav-number">5.1.</span> <span class="nav-text">The cascading calls of React.createElement()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactCompositeComponent-ins-instantiateReactComponent-—-Create-ReactDOMComponent-6"><span class="nav-number">5.2.</span> <span class="nav-text">ReactCompositeComponent[ins]._instantiateReactComponent() — Create ReactDOMComponent[6]</span></a></li></ol></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2020 Holmes He 
        
              <a class='ext-link' href="https://creativecommons.org/licenses/by-nd/4.0/">
                <img style="padding-bottom:4px" src="https://mirrors.creativecommons.org/presskit/buttons/80x15/svg/by-nd.svg"/>
              </a>
              <a class='ext-link' href="mailto:holmeshe@hotmail.com">
                <i style="color:#9ea6a6;" class="fas fa-envelope"></i>
              </a>
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>, icons by <a href="https://www.flaticon.com/authors/prettycons" title="prettycons">prettycons</a>, <a href="https://www.freepik.com/" title="Freepik">Freepik</a> and <a href="https://www.flaticon.com/authors/google" title="Google">Google</a> on <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>

    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-104935393-1', 'auto');
ga('send', 'pageview');

</script>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5381847417546942",
    enable_page_level_ads: true
  });
</script>
<!-- End Google Analytics -->
<!--<script type="text/javascript"> var infolinks_pid = 3169448; var infolinks_wsid = 0; </script> <script type="text/javascript" src="//resources.infolinks.com/js/infolinks_main.js"></script> -->





  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  <script type="text/javascript" src="/js/cust.js" async=""></script>
</body>
</html>
